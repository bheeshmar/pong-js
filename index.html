<!DOCTYPE html>
<html>
<head>
<title>PONG!</title>
<style>
  canvas { border: 1px solid black; }
</style>
</head>

<body onload="draw();" onmousedown="toggle_simulation();">
	<canvas id="canvas" width="400" height="400"></canvas>
</body>
<script>
  var interval;
  function run_simulation() { interval = window.setInterval(game_loop, 100); }
  function pause_simulation() { window.clearInterval(interval); interval = null; }
  function toggle_simulation() { 
    if (interval != null) { 
      pause_simulation();
      } else {
      run_simulation();
    }
  }

  var x = 10;
  var y = 40;
  var dx = 5;
  var dy = 4;
  var min_x = 0;
  var min_y = 0;
  var max_x = 400;
  var max_y = 400;
  var paddle_x = 200;
  var paddle_y = max_y - 20;
  var canvas = document.getElementById('canvas');

  canvas.addEventListener("mousemove", function(event) {
    paddle_x = event.clientX;
  }, false);

  function game_loop() { update(); draw(); }

  function hit_paddle() {
    return (dy > 0 && 
    y >= paddle_y && 
    x >= (paddle_x - 20) && 
    x <= (paddle_x + 20));
  }

  function bounce_x() {
      dx = -dx;
  }

  function bounce_y() {
      dy = -dy;
  }

  function update() {
    x += dx;
    y += dy;
    if (hit_paddle()) {
      bounce_y();
    }
    if (x > max_x) {
      bounce_x();
      x = max_x;
    }
    if (x < min_x) {
      bounce_x();
      x = min_x;
    }
    if (y > max_y) {
      bounce_y();
      y = max_y;
    }
    if (y < min_y) {
      bounce_y();
      y = min_y;
    }
  }

  function draw(){
    var ctx = canvas.getContext('2d');
    ctx.clearRect(min_x, min_y, max_x, max_y);
    ctx.fillRect(x,y,10,10);

    // paddle
    ctx.fillRect(paddle_x-20, paddle_y, 40, 10);

  }
</script>
</html>
<!-- vim: ts=2:sw=2:et
-->
